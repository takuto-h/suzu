
NATIVE_ENABLED = false
BYTE_ENABLED = true

SUZU_FILES[] =\
  snPervasives snString pos source token lexer literal selector expr parser\
  value eva modPervasives modInt modBool modString interp main

PROGRAM = suzu
PROGRAM_FILES[] = $(SUZU_FILES)

OCAMLCFLAGS += -annot

TOP = suzutop
TOP_FILES[] = $(addsuffix .cmo, $(SUZU_FILES))

.DEFAULT: $(PROGRAM)

OCamlProgram($(PROGRAM), $(PROGRAM_FILES))

.PHONY: run
run: $(PROGRAM)
    ./$(PROGRAM)

.PHONY: test
test: $(PROGRAM)
    ./$(PROGRAM) test.sn

$(TOP): $(TOP_FILES)
    $(OCAMLMKTOP) -o $(TOP) $(TOP_FILES)

.PHONY: top
top: $(TOP)
    ./$(TOP)

.PHONY: clean
clean:
    rm $(filter-proper-targets $(ls R, .))
