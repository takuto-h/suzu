
NATIVE_ENABLED = false
BYTE_ENABLED = true

SUZU_FILES[] =\
  snPervasives snString snChar pos source token lexer literal selector varOrMethod expr parser\
  eva interp builtin prelude compiler cont loader main

PROGRAM = suzu
PROGRAM_FILES[] = $(SUZU_FILES)

TOP = suzutop
TOP_FILES[] = $(addsuffix .cmo, $(SUZU_FILES))

SN2ML = sn2ml
SN2ML_FILES[] = snPervasives sn2ml

.DEFAULT: $(PROGRAM)

OCamlProgram($(PROGRAM), $(PROGRAM_FILES))
OCamlProgram($(SN2ML), $(SN2ML_FILES))

%.ml: %.sn $(SN2ML)
    ./$(SN2ML) $(absname $<)

.PHONY: run
run: $(PROGRAM)
    ./$(PROGRAM)

.PHONY: test
test: $(PROGRAM)
    ./$(PROGRAM) test.sn

$(TOP): $(TOP_FILES)
    $(OCAMLMKTOP) -o $(TOP) $(TOP_FILES)

.PHONY: top
top: $(TOP)
    ./$(TOP)

.PHONY: clean
clean:
    rm $(filter-proper-targets $(ls R, .))
